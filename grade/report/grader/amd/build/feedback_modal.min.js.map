{"version":3,"file":"feedback_modal.min.js","sources":["../src/feedback_modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript module for displaying feedback in a modal window\n *\n * @module      gradereport_grader/feedback_modal\n * @copyright   2023 Kevin Percy <kevin.percy@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalFactory from 'core/modal_factory';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nconst Selectors = {\n    showFeedback: '[data-action=\"feedback\"]',\n    userId: 'tr[data-uid]',\n    itemId: 'td[data-itemid]'\n};\n\n/**\n * Create the modal to display the feedback.\n *\n * @param {int} userid\n * @param {int} itemid\n * @returns {Promise}\n */\nconst getModal = async(userid, itemid) => {\n    let feedbackData = await fetchFeedback(userid, itemid);\n\n    return ModalFactory.create({\n        title: 'Feedback',\n        removeOnClose: true,\n        large: true\n    })\n    .then(modal => {\n        let body = Templates.render('core_grades/feedback_modal', {\n            feedbacktext: feedbackData.feedbacktext,\n            user: {\n                picture: feedbackData.picture,\n                fullname: feedbackData.fullname,\n                additionalfield: feedbackData.additionalfield,\n            },\n        });\n\n        modal.setBody(body);\n        modal.setTitle(feedbackData.title);\n        modal.show();\n\n        return modal;\n    });\n};\n\n/**\n * Fetch the feedback data.\n *\n * @param {int} userid\n * @param {int} itemid\n * @returns {Promise}\n */\nexport const fetchFeedback = (userid, itemid) => {\n    const request = {\n        methodname: 'core_grades_get_feedback',\n        args: {\n            userid: userid,\n            itemid: itemid,\n        },\n    };\n    return ajax.call([request])[0];\n};\n\n/**\n * Register event listeners for the View Feedback links.\n */\nconst registerEventListeners = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.showFeedback)) {\n            e.preventDefault();\n\n            getModal(e.target.closest(Selectors.userId).dataset.uid, e.target.closest(Selectors.itemId).dataset.itemid);\n\n            return;\n        }\n    });\n};\n\n/**\n * Initialize module\n */\nexport const init = () => {\n    registerEventListeners();\n};\n"],"names":["Selectors","fetchFeedback","userid","itemid","request","methodname","args","ajax","call","registerEventListeners","document","addEventListener","e","target","closest","preventDefault","async","feedbackData","ModalFactory","create","title","removeOnClose","large","then","modal","body","Templates","render","feedbacktext","user","picture","fullname","additionalfield","setBody","setTitle","show","getModal","dataset","uid"],"mappings":";;;;;;;uPA0BMA,uBACY,2BADZA,iBAEM,eAFNA,iBAGM,kBA2CCC,cAAgB,CAACC,OAAQC,gBAC5BC,QAAU,CACZC,WAAY,2BACZC,KAAM,CACFJ,OAAQA,OACRC,OAAQA,gBAGTI,cAAKC,KAAK,CAACJ,UAAU,+CAM1BK,uBAAyB,KAC3BC,SAASC,iBAAiB,SAASC,OAC3BA,EAAEC,OAAOC,QAAQd,+BACjBY,EAAEG,qBAlDGC,OAAMd,OAAQC,cACvBc,mBAAqBhB,cAAcC,OAAQC,QAExCe,uBAAaC,OAAO,CACvBC,MAAO,WACPC,eAAe,EACfC,OAAO,IAEVC,MAAKC,YACEC,KAAOC,mBAAUC,OAAO,6BAA8B,CACtDC,aAAcX,aAAaW,aAC3BC,KAAM,CACFC,QAASb,aAAaa,QACtBC,SAAUd,aAAac,SACvBC,gBAAiBf,aAAae,0BAItCR,MAAMS,QAAQR,MACdD,MAAMU,SAASjB,aAAaG,OAC5BI,MAAMW,OAECX,UA8BHY,CAASxB,EAAEC,OAAOC,QAAQd,kBAAkBqC,QAAQC,IAAK1B,EAAEC,OAAOC,QAAQd,kBAAkBqC,QAAQlC,0BAU5F,KAChBM"}